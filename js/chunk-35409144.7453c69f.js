(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-35409144"],{1293:function(t,e,s){},"28cd":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Page",[s("section",[s("h2",{staticClass:"breadcrumbs m-b-0"},[s("span",[s("span",{staticClass:"i-signal m-r-10"}),s("span",[t._v(t._s(t.$t("sensors.title")))])]),s("i",[t._v("/")]),s("span",[t._v(t._s(t.nameModel)+" "+t._s(t.miniAddrAgent))])]),s("modals-container"),t.robonomics?[t.result?s("SensorResult",{attrs:{lighthouse:t.lighthouse,model:t.model,agent:t.agent,result:t.result}}):t._e(),t.substrateBlock?s("SensorResultSubstrate",{attrs:{lighthouse:t.lighthouse,model:t.model,agent:t.agent,substrateBlock:t.substrateBlock,substrateTx:t.substrateTx}}):t.cost>0?s("SensorCost",{attrs:{lighthouse:t.lighthouse,model:t.model,agent:t.agent,tokenAddress:t.token,cost:t.cost}}):s("SensorFree",{attrs:{lighthouse:t.lighthouse,model:t.model,agent:t.agent,result:t.result}})]:[t.error?s("div",{staticClass:"red"},[t._v(t._s(t.error))]):s("div",[t._v("...")])]],2)])},n=[],r=(s("99af"),s("fb6a"),s("96cf"),s("c964")),i=s("719a"),o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.ready?s("div",[s("h4",[t._v(" "+t._s(t.$t("sensor.statusAgent"))+": "),0===t.log.length?[t._v(t._s(t.$t("sensor.notStatusAgent")))]:[t._v(" "+t._s(t.$t("sensor.yesStatusAgent"))+" "+t._s(t.log[t.log.length-1].create_time)+" ")]],2),t.$robonomics.account?s("section",[s("div",{staticClass:"input-size--md"},[t.peersIpfs>0?[t.isRequest?s("RButton",{attrs:{fullWidth:"",color:"green",disabled:""}},[t._v(t._s(t.$t("sensor.requested")))]):s("RButton",{attrs:{fullWidth:"",color:"green"},nativeOn:{click:function(e){return t.sendMsgDemand(e)}}},[t._v(t._s(t.$t("sensor.isRequest")))])]:[s("RButton",{attrs:{fullWidth:"",color:"green",disabled:""}},[t._v(t._s(t.$t("sensor.requested")))]),s("p",{staticClass:"red"},[t._v("Not found ipfs peers")])]],2)]):t._e(),t.log.length>0?s("RWindow",{attrs:{id:"window-sensornetwork-requests"}},[s("template",{slot:"header"},[s("span",[t._v(" "+t._s(t.$t("sensor.requests"))+" ("+t._s(t.log.length)+") "),s("RButton",{staticStyle:{background:"none",color:"#03a5ed",border:"2px solid #03a5ed","padding-top":"2px","padding-bottom":"2px","margin-left":"15px"},nativeOn:{click:function(e){return t.clear(e)}}},[t._v(t._s(t.$t("sensor.clear")))])],1)]),s("Pagination",{attrs:{listData:t.log,currentPage:t.currentPage},on:{"on-page":t.handlePage},scopedSlots:t._u([{key:"default",fn:function(e){return[s("RCard",[s("Message",{attrs:{item:e.item,lighthouse:t.lighthouse,model:t.model,agent:t.agent}})],1)]}}],null,!1,2391056252)})],2):t._e()],1):t._e()])},c=[],l=(s("c740"),s("4160"),s("b64b"),s("07ac"),s("159b"),s("f3f3")),u=s("4aac"),d=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t._l(t.paginatedData,(function(e,a){return s("div",{key:a},[t._t("default",null,{item:e})],2)})),s("button",{attrs:{disabled:0===t.pageNumber},on:{click:t.prevPage}},[t._v("Previous")]),s("button",{staticClass:"m-l-15",attrs:{disabled:t.pageNumber>=t.pageCount-1},on:{click:t.nextPage}},[t._v(" Next ")])],2)},h=[],g=(s("a9e3"),{props:{listData:{type:Array,required:!0},currentPage:{type:Number,required:!1,default:0},size:{type:Number,required:!1,default:1}},data:function(){return{pageNumber:this.currentPage}},watch:{currentPage:function(t){this.pageNumber=t}},computed:{pageCount:function(){var t=this.listData.length,e=this.size;return Math.ceil(t/e)},paginatedData:function(){var t=this.pageNumber*this.size,e=t+this.size;return this.listData.slice(t,e)}},methods:{nextPage:function(){this.pageNumber++,this.$emit("on-page",this.pageNumber)},prevPage:function(){this.pageNumber--,this.$emit("on-page",this.pageNumber)}}}),m=g,p=s("2877"),b=Object(p["a"])(m,d,h,!1,null,null,null),v=b.exports,f=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.item.create_time?s("h3",[t._v(" "+t._s(t.$t("sensor.requestAt"))+" "+t._s(t.item.create_time)+" ")]):t._e(),1===t.item.status?s("div",{staticClass:"animation-fadein"},[s("p",[s("span",{staticClass:"loader-ring align-vertical m-r-15"}),s("b",{staticClass:"align-vertical"},[t._v("1. "+t._s(t.$t("sensor.free.status1")))])])]):2===t.item.status?s("div",[s("p",[s("b",{staticClass:"align-vertical"},[t._v("1. "+t._s(t.$t("sensor.free.status21")))]),s("br"),s("span",[t._v(t._s(t.$t("sensor.cost.hash"))+":")]),s("br"),s("RIpfsExplorer",{attrs:{hash:t.item.resultHash,classStyle:"align-vertical"}}),s("a",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.item.resultHash,expression:"item.resultHash",arg:"copy"}],staticClass:"align-vertical i-copy m-l-10",attrs:{href:"javascript:;",title:"copy to clipboard"}})],1),s("p",[s("span",{staticClass:"loader-ring align-vertical m-r-15"}),s("b",{staticClass:"align-vertical"},[t._v("2. "+t._s(t.$t("sensor.free.status22")))])]),s("MessageShare",{attrs:{item:t.item,lighthouse:t.lighthouse,model:t.model,agent:t.agent,isSubstrate:!0}})],1):3===t.item.status?s("div",[s("p",[s("b",{staticClass:"align-vertical"},[t._v("1. "+t._s(t.$t("sensor.free.status31")))]),s("br"),s("span",[t._v(t._s(t.$t("sensor.cost.hash"))+":")]),s("br"),s("RIpfsExplorer",{attrs:{hash:t.item.resultHash,classStyle:"align-vertical"}}),s("a",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.item.resultHash,expression:"item.resultHash",arg:"copy"}],staticClass:"align-vertical i-copy m-l-10",attrs:{href:"javascript:;",title:"copy to clipboard"}})],1),s("p",[s("b",{staticClass:"align-vertical"},[t._v("2. "+t._s(t.$t("sensor.free.status32")))]),s("a",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:JSON.stringify(t.item.result),expression:"JSON.stringify(item.result)",arg:"copy"}],staticClass:"align-vertical i-copy m-l-10",attrs:{href:"javascript:;",title:"copy to clipboard"}}),s("br"),s("code",[s("pre",[t._v(t._s(t.item.result))])])]),s("MessageShare",{attrs:{item:t.item,lighthouse:t.lighthouse,model:t.model,agent:t.agent,isSubstrate:!0}})],1):t._e()])},_=[],y=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",{staticClass:"icons-line"},[s("span",{staticStyle:{"vertical-align":"middle",width:"24px",display:"inline-block",height:"24px",background:"url(img/ipfs.png) 0% 0% / 24px no-repeat"}}),s("a",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.getLink("ipfs",t.item.resultHash),expression:"getLink('ipfs', item.resultHash)",arg:"copy"}],staticClass:"i-share",attrs:{href:"javascript:;",title:"copy to clipboard"}}),s("a",{staticClass:"i-twitter",attrs:{href:t.getLinkTwitter("ipfs",t.item.resultHash),target:"_blank"}}),t.isSubstrate?[s("span",{staticStyle:{"margin-left":"20px"}},[t._v("|")]),""==t.substrateBlockHash?[""==t.substrateBlockHash?s("a",{staticStyle:{width:"24px",display:"inline-block",height:"24px",background:"url(img/substrate.png) 0% 0% / 24px no-repeat"},attrs:{href:"javascript:;"},on:{click:function(e){return t.sendSubstrate(t.item.resultHash)}}}):t._e(),t._m(0)]:[s("span",{staticStyle:{"vertical-align":"middle","margin-left":"20px",width:"24px",display:"inline-block",height:"24px",background:"url(img/substrate.png) 0% 0% / 24px no-repeat"}}),s("span",{staticStyle:{"margin-left":"20px"}},[s("a",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.getLink("substrate",t.substrateBlockHash,t.substrateTxHash),expression:"\n            getLink('substrate', substrateBlockHash, substrateTxHash)\n          ",arg:"copy"}],staticClass:"i-share",attrs:{href:"javascript:;",title:"copy to clipboard"}}),s("a",{staticClass:"i-twitter",attrs:{href:t.getLinkTwitter("substrate",t.substrateBlockHash,t.substrateTxHash),target:"_blank"}})])]]:t._e()],2)},w=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",{staticClass:"disabled",staticStyle:{"margin-left":"20px"}},[s("a",{staticClass:"i-share",attrs:{href:""}}),s("a",{staticClass:"i-twitter",attrs:{href:""}})])}],k=(s("d81d"),s("b0c0"),s("276c")),x=s("e954"),$=function(){function t(e){Object(k["a"])(this,t),this.name=e}return Object(x["a"])(t,[{key:"getItems",value:function(){var t=localStorage.getItem(this.name);return t?JSON.parse(t):{}}},{key:"addItem",value:function(t,e){var s=this.getItems();s[t]=e,this.saveItems(s)}},{key:"saveItems",value:function(t){localStorage.setItem(this.name,JSON.stringify(t))}},{key:"clear",value:function(){localStorage.removeItem(this.name)}}]),t}(),S=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"modal-wrapper"},[s("h2",[t._v(t._s(t.$t("sensor.modalTitle")))]),s("div",{staticClass:"modal-content"},[s("div",{staticClass:"item"},[s("select",{directives:[{name:"model",rawName:"v-model",value:t.selected,expression:"selected"}],on:{change:function(e){var s=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.selected=e.target.multiple?s:s[0]}}},t._l(t.accounts,(function(e,a){return s("option",{key:a,domProps:{value:e.value}},[t._v(" "+t._s(e.text)+" ")])})),0)]),s("div",{staticClass:"item"},[s("button",{attrs:{disabled:t.isWork||!t.isBalance},on:{click:t.send}},[t.isWork?s("div",{staticClass:"loader-ring"}):t._e(),t._v(" "+t._s(t.$t("sensor.modalBtn"))+" ")])]),s("div",{staticStyle:{width:"100%"}}),s("div",[t._v(" Balance: "),s("b",[s("Balance",{attrs:{account:t.selected},on:{balance:t.handleBalance}})],1)])])])},j=[],O=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("span",[t._v(t._s(t.balance))])},C=[],R=(s("d3b7"),s("25f0"),s("4c53"),s("4687")),H=(s("ac1f"),s("5319"),s("1276"),s("498a"),s("d0af")),I=s("bc3a"),B=s.n(I),A=s("cfb0"),P=s("0763"),N=s("1349"),E=(s("85a5"),s("f121"));function L(t){return T.apply(this,arguments)}function T(){return T=Object(r["a"])(regeneratorRuntime.mark((function t(e){var s,a,n,r=arguments;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s=r.length>1&&void 0!==r[1]?r[1]:{topics:["/data"]},B.a.get("".concat(E["a"].IPFS_GATEWAY).concat(e)).then((function(){console.log("result ipfs hash resolved")})),t.next=4,A["c"].cat(e);case 4:return a=t.sent,n={},t.next=8,Object(P["a"])(new Blob([a]),(function(t){try{n=JSON.parse(t.message.data)}catch(e){console.log(e)}}),s);case 8:return t.abrupt("return",n);case 9:case"end":return t.stop()}}),t)}))),T.apply(this,arguments)}function D(t){return new Promise((function(e,s){var a=document.createElement("script");a.src=t,a.onload=e,a.onerror=s,document.body.appendChild(a)}))}var q=7,M=4;function W(t,e){var s=Object(H["a"])(e,2),a=s[0],n=s[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=Object(N["a"])(t,{decimals:a,forceUnit:"-",withSi:!1}).split("."),l=Object(H["a"])(c,2),u=l[0],d=l[1],h=o||i&&u.length>=M,g=r?n:"";if(u.length>q){var m=Object(N["a"])(t,{decimals:a,withUnit:!1}).split("."),p=Object(H["a"])(m,2),b=p[0],v=p[1],f=v.substr(0,4),_=v.substr(4);return"".concat(b,".").concat(f," ").concat(_.trim()).concat(g)}return"".concat(u).concat(h?"":".").concat(!h&&"0000".concat(d||"").slice(-4)," ").concat(g)}function J(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"XRT",a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return a?Object(N["a"])(t.toString(),{decimals:e,withUnit:s}):W(t.toString(),[e,s]).replace(",","")}var F={CHAIN:"robonomics"},z={props:["account"],data:function(){return{balance:null,listener:null}},created:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.robonomics=R["b"].getInstance(F.CHAIN),t.listen();case 2:case"end":return e.stop()}}),e)})))()},destroyed:function(){this.listener&&this.listener()},watch:{account:function(){this.listener&&(this.listener(),this.listen())}},methods:{listen:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.robonomics.account.getBalance(t.account,(function(e){var s=e.free.sub(e.miscFrozen);t.balance=J(s.toString(),t.robonomics.api.registry.chainDecimals[0],t.robonomics.api.registry.chainTokens[0]),t.$emit("balance",{account:t.account,balance:s.toString(),chainDecimals:t.robonomics.api.registry.chainDecimals[0],chainTokens:t.robonomics.api.registry.chainTokens[0],format:t.balance})}));case 2:t.listener=e.sent;case 3:case"end":return e.stop()}}),e)})))()}}},U=z,G=Object(p["a"])(U,O,C,!1,null,null,null),Y=G.exports,V={props:["accounts","select"],components:{Balance:Y},data:function(){return{selected:null,isWork:!1,balance:0}},computed:{isBalance:function(){return Number(this.balance)>0}},created:function(){this.selected=this.accounts[0].value},methods:{send:function(){var t=this;this.isWork=!0,this.select(this.selected,(function(){return t.$emit("close")}),(function(){t.isWork=!1}))},handleBalance:function(t){this.balance=t.balance}}},X=V,K=(s("80cd"),Object(p["a"])(X,S,j,!1,null,"2a7a1e32",null)),Q=K.exports,Z=s("605b"),tt={props:["item","lighthouse","model","agent","isSubstrate"],data:function(){return{substrateBlockHash:"",substrateTxHash:"",storage:new $("sn_".concat(this.lighthouse,"_").concat(this.model,"_").concat(this.agent,"_free_v1"))}},created:function(){this.item.substrateBlockHash&&(this.substrateBlockHash=this.item.substrateBlockHash,this.substrateTxHash=this.item.substrateTxHash)},watch:{item:function(t){t.substrateBlockHash?(this.substrateBlockHash=t.substrateBlockHash,this.substrateTxHash=t.substrateTxHash):(this.substrateBlockHash="",this.substrateTxHash="")}},methods:{getLink:function(t,e){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"substrate"===t?"".concat(window.location.origin,"/").concat(this.$router.resolve({name:"sensor-result-substrate",params:{lighthouse:this.lighthouse,model:this.model,agent:this.agent,substrateBlock:e,substrateTx:s}}).href):"".concat(window.location.origin,"/").concat(this.$router.resolve({name:"sensor-result",params:{lighthouse:this.lighthouse,model:this.model,agent:this.agent,result:e}}).href)},getDescription:function(t){return"substrate"===t?"Look data from my sensor in Substrate Blockchain via Robonomics dapp: ":"Look data from my sensor in IPFS via Robonomics dapp: "},getLinkTwitter:function(t,e){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"https://twitter.com/intent/tweet?text=".concat(window.encodeURIComponent(this.getDescription(t)+this.getLink(t,e,s)),"&ref_src=twsrc%5Etfw")},sendSubstrate:function(t){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function s(){var a,n,i;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:a=R["b"].getInstance(F.CHAIN),n=a.accountManager.getAccounts(),i=n.map((function(t){return{value:t.address,text:"".concat(t.meta.name," (").concat(t.meta.isInjected?"injected":"dev",")")}})),e.$modal.show(Q,{accounts:i,select:function(){var s=Object(r["a"])(regeneratorRuntime.mark((function s(n,r,i){var o,c,l;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,a.accountManager.selectAccountByAddress(n);case 2:return s.next=4,a.datalog.write(Object(Z["a"])(t));case 4:return o=s.sent,s.prev=5,s.next=8,a.accountManager.signAndSend(o);case 8:c=s.sent,console.log("saved block",c.block,c.tx),r(),e.substrateBlockHash=c.block,e.substrateTxHash=c.tx,l=e.findId((function(t){return t.resultHash===e.item.resultHash})),l&&e.upadte(l,{substrateBlockHash:e.substrateBlockHash,substrateTxHash:e.substrateTxHash}),s.next=21;break;case 17:s.prev=17,s.t0=s["catch"](5),console.log(s.t0.message),i();case 21:case"end":return s.stop()}}),s,null,[[5,17]])})));function n(t,e,a){return s.apply(this,arguments)}return n}()});case 4:case"end":return s.stop()}}),s)})))()},findId:function(t){var e=this.storage.getItems(),s=Object.keys(e),a=s.findIndex((function(s){return t(e[s])}));return a>=0&&s[a]},upadte:function(t,e){var s=this.storage.getItems(),a=Object(l["a"])(Object(l["a"])(Object(l["a"])({},s[t]),e),{},{update_time:(new Date).toLocaleString()});this.storage.addItem(a.id,a)}}},et=tt,st=Object(p["a"])(et,y,w,!1,null,null,null),at=st.exports,nt={props:["item","lighthouse","model","agent"],components:{MessageShare:at}},rt=nt,it=Object(p["a"])(rt,f,_,!1,null,null,null),ot=it.exports,ct=s("b893"),lt=s("8a8b"),ut=100,dt={props:["lighthouse","model","agent"],components:{Pagination:v,Message:ot},data:function(){return{peersIpfs:0,ready:!1,isRequest:!1,log:[],currentPage:0,storage:new $("sn_".concat(this.lighthouse,"_").concat(this.model,"_").concat(this.agent,"_free_v1"))}},mounted:function(){var t=this;D("https://platform.twitter.com/widgets.js"),this.$robonomics.messenger&&this.$robonomics.messenger.stop(),this.$robonomics.initLighthouse(this.lighthouse).then((function(){t.ready=!0,t.upLog(),t.log.forEach((function(e){2===e.status&&L(e.resultHash).then((function(s){t.upadte(e.id,{status:3,result:s})}))})),t.$robonomics.onDemand(t.model,(function(t){console.log("demand",t)})),t.$robonomics.onResult((function(e){var s=u["Account"].recoveryMessage(e);if(console.log("open",e,s),s.toLowerCase()===t.agent.toLowerCase()&&"0x0000000000000000000000000000000000000000"===e.liability&&t.add(),s.toLowerCase()===t.agent.toLowerCase()&&("0x0000000000000000000000000000000000000000"===e.liability||t.$robonomics.account&&e.liability===t.$robonomics.account.address)){var a=t.findId((function(t){return 1===t.status}));a&&(t.upadte(a,{status:2,resultHash:e.result}),L(e.result).then((function(e){t.upadte(a,{status:3,result:e})})))}}))}))},created:function(){this.getPeers()},methods:{getPeers:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(ct["a"])(t.$ipfs,t.$robonomics,Object(lt["a"])().statusPeers);case 3:s=e.sent,t.peersIpfs=s.required.length,e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),t.peersIpfs=0;case 10:setTimeout((function(){t.getPeers()}),5e3);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))()},upLog:function(){var t=this.storage.getItems(),e=Object.keys(t),s=e.length-ut;if(s>0){for(var a=0;a<s;a++)delete t[e[a]];this.storage.saveItems(t)}this.log=Object.values(t).reverse()},add:function(){var t={id:Date.now(),create_time:(new Date).toLocaleString(),update_time:(new Date).toLocaleString(),status:1};this.storage.addItem(t.id,t),this.upLog(),this.currentPage>0&&this.currentPage<this.log.length-1&&(this.currentPage+=1)},findId:function(t){var e=this.storage.getItems(),s=Object.keys(e),a=s.findIndex((function(s){return t(e[s])}));return a>=0&&s[a]},upadte:function(t,e){var s=this.storage.getItems(),a=Object(l["a"])(Object(l["a"])(Object(l["a"])({},s[t]),e),{},{update_time:(new Date).toLocaleString()});this.storage.addItem(a.id,a),this.upLog()},handlePage:function(t){this.currentPage=t},sendMsgDemand:function(){var t=this;this.isRequest=!0,this.$robonomics.web3.eth.getBlock("latest",(function(e,s){var a={model:t.model,objective:E["a"].DEFAULT_OBJECTIVE,token:t.$robonomics.xrt.address,cost:0,lighthouse:t.$robonomics.lighthouse.address,validator:"0x0000000000000000000000000000000000000000",validatorFee:0,deadline:s.number+1e3};t.$robonomics.sendDemand(a,!1,(function(){t.isRequest=!1,t.add()})).catch((function(e){t.isRequest=!1,console.log(e)}))}))},clear:function(){this.storage.clear(),this.log=[],this.currentPage=0}}},ht=dt,gt=Object(p["a"])(ht,o,c,!1,null,null,null),mt=gt.exports,pt=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.ready?s("div",[s("h4",[t._v(" "+t._s(t.$t("sensor.statusAgent"))+": "),0===t.log.length?[t._v(t._s(t.$t("sensor.notStatusAgent")))]:[t._v(" "+t._s(t.$t("sensor.yesStatusAgent"))+" "+t._s(t.log[t.log.length-1].time)+" ")]],2),t.$robonomics.account?s("section",[Number(t.cost)>0&&t.tokenAddress?s("Approve",{attrs:{address:t.tokenAddress,from:t.$robonomics.account.address,to:t.$robonomics.factory.address,initAmountWei:t.cost,alwaysShow:!1}}):t._e(),Number(t.myAllowance)>=Number(t.cost)?s("div",{staticClass:"input-size--md"},[t.isRequest?s("RButton",{attrs:{fullWidth:"",color:"green",disabled:""}},[t._v(" "+t._s(t.$t("sensor.requested"))+" ")]):s("RButton",{attrs:{fullWidth:"",color:"green"},nativeOn:{click:function(e){return t.sendMsgDemand(e)}}},[t._v(t._s(t.$t("sensor.isRequest")))])],1):t._e()],1):t._e(),t.log.length>0?s("RWindow",{attrs:{id:"window-sensornetwork-requests"}},[s("template",{slot:"header"},[s("span",[t._v(" "+t._s(t.$t("sensor.requests"))+" ("+t._s(t.log.length)+") "),s("RButton",{staticStyle:{background:"none",color:"#03a5ed",border:"2px solid #03a5ed","padding-top":"2px","padding-bottom":"2px","margin-left":"15px"},nativeOn:{click:function(e){return t.clear(e)}}},[t._v(t._s(t.$t("sensor.clear")))])],1)]),s("Pagination",{attrs:{listData:t.log,currentPage:t.currentPage},on:{"on-page":t.handlePage},scopedSlots:t._u([{key:"default",fn:function(e){return[s("RCard",[s("Message",{attrs:{item:e.item,lighthouse:t.lighthouse,model:t.model,agent:t.agent}})],1)]}}],null,!1,2391056252)})],2):t._e()],1):t._e()])},bt=[],vt=s("2227"),ft=s("8958"),_t=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.item.create_time?s("h3",[t._v(" "+t._s(t.$t("sensor.requestAt"))+" "+t._s(t.item.create_time)+" ")]):t._e(),1===t.item.status?s("div",{staticClass:"animation-fadein"},[s("p",[s("span",{staticClass:"loader-ring align-vertical m-r-15"}),s("b",{staticClass:"align-vertical"},[t._v("1. "+t._s(t.$t("sensor.cost.status1")))])])]):2===t.item.status?s("div",[s("p",[s("b",{staticClass:"align-vertical"},[t._v("1. "+t._s(t.$t("sensor.cost.status21")))]),s("br"),s("span",[t._v(t._s(t.$t("sensor.cost.address"))+":")]),s("br"),s("RIpfsExplorer",{attrs:{hash:t.item.liability,classStyle:"align-vertical"}}),s("a",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.item.liability,expression:"item.liability",arg:"copy"}],staticClass:"align-vertical i-copy m-l-10",attrs:{href:"javascript:;",title:"copy to clipboard"}})],1),s("p",[s("span",{staticClass:"loader-ring align-vertical m-r-15"}),s("b",{staticClass:"align-vertical"},[t._v("2. "+t._s(t.$t("sensor.cost.status22")))])])]):3===t.item.status?s("div",[s("p",[s("b",{staticClass:"align-vertical"},[t._v("1. "+t._s(t.$t("sensor.cost.status21")))]),s("br"),s("span",[t._v(t._s(t.$t("sensor.cost.address"))+":")]),s("br"),s("RIpfsExplorer",{attrs:{hash:t.item.liability,classStyle:"align-vertical"}}),s("a",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.item.liability,expression:"item.liability",arg:"copy"}],staticClass:"align-vertical i-copy m-l-10",attrs:{href:"javascript:;",title:"copy to clipboard"}})],1),s("p",[s("b",{staticClass:"align-vertical"},[t._v("2. "+t._s(t.$t("sensor.cost.status31")))]),s("br"),s("span",[t._v(t._s(t.$t("sensor.cost.hash"))+":")]),s("br"),s("RIpfsExplorer",{attrs:{hash:t.item.resultHash,classStyle:"align-vertical"}}),s("a",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.item.resultHash,expression:"item.resultHash",arg:"copy"}],staticClass:"align-vertical i-copy m-l-10",attrs:{href:"javascript:;",title:"copy to clipboard"}})],1),s("p",[s("span",{staticClass:"loader-ring align-vertical m-r-15"}),s("b",{staticClass:"align-vertical"},[t._v("3. "+t._s(t.$t("sensor.cost.status32")))])]),s("MessageShare",{attrs:{item:t.item,lighthouse:t.lighthouse,model:t.model,agent:t.agent}})],1):4===t.item.status?s("div",[s("p",[s("b",{staticClass:"align-vertical"},[t._v("1. "+t._s(t.$t("sensor.cost.status21")))]),s("br"),s("span",[t._v(t._s(t.$t("sensor.cost.address"))+":")]),s("br"),s("RIpfsExplorer",{attrs:{hash:t.item.liability,classStyle:"align-vertical"}}),s("a",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.item.liability,expression:"item.liability",arg:"copy"}],staticClass:"align-vertical i-copy m-l-10",attrs:{href:"javascript:;",title:"copy to clipboard"}})],1),s("p",[s("b",{staticClass:"align-vertical"},[t._v("2. "+t._s(t.$t("sensor.cost.status41")))]),s("br"),s("span",[t._v(t._s(t.$t("sensor.cost.hash"))+":")]),s("br"),s("RIpfsExplorer",{attrs:{hash:t.item.resultHash,classStyle:"align-vertical"}}),s("a",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.item.resultHash,expression:"item.resultHash",arg:"copy"}],staticClass:"align-vertical i-copy m-l-10",attrs:{href:"javascript:;",title:"copy to clipboard"}})],1),s("p",[s("b",{staticClass:"align-vertical"},[t._v("3. "+t._s(t.$t("sensor.cost.status42")))]),s("a",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:JSON.stringify(t.item.result),expression:"JSON.stringify(item.result)",arg:"copy"}],staticClass:"align-vertical i-copy m-l-10",attrs:{href:"javascript:;",title:"copy to clipboard"}}),s("br"),s("code",[s("pre",[t._v(t._s(t.item.result))])])]),s("MessageShare",{attrs:{item:t.item,lighthouse:t.lighthouse,model:t.model,agent:t.agent}})],1):t._e()])},yt=[],wt={props:["item","lighthouse","model","agent"],components:{MessageShare:at}},kt=wt,xt=Object(p["a"])(kt,_t,yt,!1,null,null,null),$t=xt.exports,St=100,jt={mixins:[ft["a"]],props:["lighthouse","model","agent","tokenAddress","cost"],components:{Pagination:v,Message:$t,Approve:vt["a"]},data:function(){return{ready:!1,isRequest:!1,log:[],currentPage:0,storage:new $("sn_".concat(this.lighthouse,"_").concat(this.model,"_").concat(this.agent,"_cost_v1"))}},mounted:function(){var t=this;D("https://platform.twitter.com/widgets.js"),this.$robonomics.messenger&&this.$robonomics.messenger.stop(),this.$robonomics.initLighthouse(this.lighthouse).then((function(){t.ready=!0,t.upLog(),t.log.forEach((function(e){if(2===e.status){var s=new u["Liability"](t.$robonomics.web3,e.liability);s.result().then((function(t){return t||s.onResult()})).then((function(s){console.log(s),t.upadte(e.id,{status:3,resultHash:s}),L(s).then((function(s){t.upadte(e.id,{status:4,result:s})}))})).catch((function(e){t.isRequest=!1,console.log(e)}))}else 3===e.status&&L(e.resultHash).then((function(s){t.upadte(e.id,{status:4,result:s})}))})),t.$robonomics.onDemand(t.model,(function(t){console.log("demand",t)})),t.$robonomics.onOffer(t.model,(function(t){console.log("offer",t)}))}))},created:function(){this.$robonomics.account&&this.watchToken(this.tokenAddress,this.$robonomics.account.address,this.$robonomics.factory.address)},computed:{myAllowance:function(){return this.$robonomics.account&&this.response?this.allowance(this.tokenAddress,this.$robonomics.account.address,this.$robonomics.factory.address):0}},methods:{upLog:function(){var t=this.storage.getItems(),e=Object.keys(t),s=e.length-St;if(s>0){for(var a=0;a<s;a++)delete t[e[a]];this.storage.saveItems(t)}this.log=Object.values(t).reverse()},add:function(){var t=Date.now(),e={id:t,create_time:(new Date).toLocaleString(),update_time:(new Date).toLocaleString(),status:1};return this.storage.addItem(e.id,e),this.upLog(),this.currentPage>0&&this.currentPage<this.log.length-1&&(this.currentPage+=1),t},upadte:function(t,e){var s=this.storage.getItems(),a=Object(l["a"])(Object(l["a"])(Object(l["a"])({},s[t]),e),{},{update_time:(new Date).toLocaleString()});this.storage.addItem(a.id,a),this.upLog()},handlePage:function(t){this.currentPage=t},sendMsgDemand:function(){var t=this;this.isRequest=!0,this.$robonomics.web3.eth.getBlock("latest",(function(e,s){var a={model:t.model,objective:E["a"].DEFAULT_OBJECTIVE,token:t.tokenAddress,cost:t.cost,lighthouse:t.$robonomics.lighthouse.address,validator:"0x0000000000000000000000000000000000000000",validatorFee:0,deadline:s.number+1e3},n=null;t.$robonomics.sendDemand(a,!0,(function(){t.isRequest=!1,n=t.add()})).then((function(e){return console.log(e.address),n&&t.upadte(n,{status:2,liability:e.address}),e.onResult()})).then((function(e){console.log(e),n&&t.upadte(n,{status:3,resultHash:e}),L(e).then((function(e){n&&t.upadte(n,{status:4,result:e})}))})).catch((function(e){t.isRequest=!1,console.log(e)}))}))},clear:function(){this.storage.clear(),this.log=[],this.currentPage=0}}},Ot=jt,Ct=Object(p["a"])(Ot,pt,bt,!1,null,null,null),Rt=Ct.exports,Ht=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.ready?s("div",{staticStyle:{"padding-top":"20px"}},[s("RWindow",{attrs:{id:"window-sensornetwork-requests"}},[s("template",{slot:"header"},[s("span",[t._v(t._s(t.$t("sensor.result")))])]),t.item?s("RCard",[s("Message",{attrs:{item:t.item,lighthouse:t.lighthouse,model:t.model,agent:t.agent,isSubstrate:!0}})],1):t._e()],2)],1):t._e()])},It=[],Bt={props:["lighthouse","model","agent","result"],components:{Message:ot},data:function(){return{ready:!1,item:null}},mounted:function(){var t=this;D("https://platform.twitter.com/widgets.js"),this.$robonomics.messenger&&this.$robonomics.messenger.stop(),this.$robonomics.initLighthouse(this.lighthouse).then((function(){t.ready=!0,t.item={status:2,resultHash:t.result},L(t.result).then((function(e){t.item=Object(l["a"])(Object(l["a"])({},t.item),{},{status:3,result:e})})).catch((function(t){console.log(t)}))}))}},At=Bt,Pt=Object(p["a"])(At,Ht,It,!1,null,null,null),Nt=Pt.exports,Et=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t.ready?s("div",{staticStyle:{"padding-top":"20px"}},[s("RWindow",{attrs:{id:"window-sensornetwork-requests"}},[s("template",{slot:"header"},[s("span",[t._v(t._s(t.$t("sensor.result")))])]),t.item?s("RCard",[s("Message",{attrs:{item:t.item,lighthouse:t.lighthouse,model:t.model,agent:t.agent,isSubstrate:!0}})],1):t._e()],2)],1):t._e()])},Lt=[],Tt=s("075f"),Dt={props:["lighthouse","model","agent","substrateBlock","substrateTx"],components:{Message:ot},data:function(){return{ready:!0,item:null}},mounted:function(){D("https://platform.twitter.com/widgets.js"),this.init()},methods:{init:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:s=R["b"].getInstance(F.CHAIN),s.api.query.system.events.at(t.substrateBlock,(function(t){t.forEach((function(t){var e=t.event;if("datalog"===e.section){var s={section:e.section,method:e.method,data:{}};Object.keys(e.data.typeDef).forEach((function(t){s.data[e.data.typeDef[t].type]=e.data[t].toString()}))}}))})),s.api.rpc.chain.getBlock(t.substrateBlock,(function(e){e.block.extrinsics.forEach((function(e){if("datalog"===e.method.section&&"record"===e.method.method&&e.hash.toString()===t.substrateTx){var s={tx:e.hash.toString(),props:{}};Object.keys(e.method.argsDef).forEach((function(t,a){s.props[t]=e.method.args[a].toString()}));var a=Object(Tt["a"])(s.props.record);t.item={status:2,resultHash:a,substrateBlockHash:t.substrateBlock,substrateTxHash:t.substrateTx},L(a).then((function(e){t.item=Object(l["a"])(Object(l["a"])({},t.item),{},{status:3,result:e})}))}}))}));case 3:case"end":return e.stop()}}),e)})))()}}},qt=Dt,Mt=Object(p["a"])(qt,Et,Lt,!1,null,null,null),Wt=Mt.exports,Jt=s("d3f5"),Ft={props:["lighthouse","model","agent","result","substrateBlock","substrateTx","token","cost"],components:{Page:i["a"],SensorFree:mt,SensorCost:Rt,SensorResult:Nt,SensorResultSubstrate:Wt},data:function(){return{robonomics:null,error:null}},computed:{miniAddrAgent:function(){return this.agent.slice(0,6)+"..."+this.agent.slice(-4)},nameModel:function(){return Object.prototype.hasOwnProperty.call(E["a"].CATEGORY_MODELS,this.model)?E["a"].CATEGORY_MODELS[this.model]:"unknown"}},created:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return document.title="".concat(t.$t("sensors.title")," ").concat(t.nameModel," – Robonomics Network dApp"),e.prev=1,e.next=4,Object(Jt["a"])(F.CHAIN);case 4:t.robonomics=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](1),t.error=e.t0.message;case 10:case"end":return e.stop()}}),e,null,[[1,7]])})))()}},zt=Ft,Ut=Object(p["a"])(zt,a,n,!1,null,null,null);e["default"]=Ut.exports},"80cd":function(t,e,s){"use strict";s("1293")}}]);
//# sourceMappingURL=chunk-35409144.7453c69f.js.map